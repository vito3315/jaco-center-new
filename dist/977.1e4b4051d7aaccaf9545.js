"use strict";(self.webpackChunkreact_ssr=self.webpackChunkreact_ssr||[]).push([[977],{3977:(t,e,n)=>{n.r(e),n.d(e,{default:()=>Z});var i=n(5861),a=n(5671),o=n(3144),r=n(7326),s=n(136),c=n(6215),l=n(1120),u=n(4942),d=n(4687),p=n.n(d),h=n(7294),f=n(4593),m=n(30),g=n(3892),y=n(5705),v=n(5710),_=n(4998),w=n(8811),k=n.n(w);var b=n(7563),Z=function(t){(0,s.Z)(D,t);var e,n,d,w,Z,I,x=(Z=D,I=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,l.Z)(Z);if(I){var n=(0,l.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,c.Z)(this,t)});function D(t){var e,n,i,o,s,c;return(0,a.Z)(this,D),e=x.call(this,t),(0,u.Z)((0,r.Z)(e),"interval",null),(0,u.Z)((0,r.Z)(e),"map",null),(0,u.Z)((0,r.Z)(e),"getData",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.setState({is_load:!0}),n.type=t,n.token=_.Z.getToken(),fetch(k().urlApi,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.stringify(n)}).then((function(t){return t.json()})).then((function(t){if(!1!==t.st||"redir"!=t.type){if(!1!==t.st||"auth"!=t.type)return setTimeout((function(){e.setState({is_load:!1})}),300),t;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(t){console.log(t),e.setState({is_load:!1})}))})),e.state={module:"concenter",module_name:"",is_load:!1,modalDialog:!1,modalDialogDel:!1,cities:[],city_id:"",date:(n=new Date,i=new Date(n),o=""+(i.getMonth()+1),s=""+i.getDate(),c=i.getFullYear(),o.length<2&&(o="0"+o),s.length<2&&(s="0"+s),[c,o,s].join("-")),point_list:[],need_point_list:[],point_id:0,indexTab:0,orders:[],ordersRender:[],showOrder:null,radiogroup_options:[{id:"0",label:"Решили отредактировать заказ",value:0},{id:"1",label:"Не устраивает время ожидания",value:0},{id:"2",label:"Изменились планы",value:0},{id:"3",label:"Недостаточно средств",value:0},{id:"4",label:"Другое",value:0}],textDel:"",typeDel:-1,number:"",addr:"",allItems:[]},e}return(0,o.Z)(D,[{key:"checkLogin",value:(w=(0,i.Z)(p().mark((function t(){var e;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={token:_.Z.getToken()},t.next=3,this.getData("check_login_center",e);case 3:!0===t.sent||(localStorage.removeItem("token"),clearInterval(this.interval),setTimeout((function(){window.location.href="/auth"}),500));case 5:case"end":return t.stop()}}),t,this)}))),function(){return w.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"componentDidMount",value:(d=(0,i.Z)(p().mark((function t(){var e,n,i=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"http:"!=window.location.protocol&&"http"!=window.location.protocol||"localhost"==window.location.hostname||(window.location.href="https://jacocallcenter.ru"+window.location.pathname),_.Z.setPage("orders"),this.interval=setInterval((function(){return i.checkLogin()}),36e5),this.checkLogin(),t.next=6,this.getData("get_center_all");case 6:e=t.sent,n=e.points.filter((function(t,n){return parseInt(t.city_id)==parseInt(e.cities[0].id)})),console.log(e),this.setState({cities:e.cities,point_list:e.points,need_point_list:n,point_id:parseInt(n[0].id),city_id:parseInt(e.cities[0].id)}),setTimeout((function(){i.getOrders(parseInt(e.cities[0].id))}),300);case 11:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"changeCity",value:(n=(0,i.Z)(p().mark((function t(e){var n,i,a=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({number:"",addr:""}),n=e.target.value,i=this.state.point_list.filter((function(t,e){return parseInt(t.city_id)==parseInt(n)})),this.setState({city_id:n,need_point_list:i,point_id:parseInt(i[0].id),indexTab:0}),setTimeout((function(){a.getOrders(parseInt(n))}),300);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"changePoint",value:function(t,e){var n=t.target.id;n=n.split("-")[2],this.setState({point_id:n,indexTab:parseInt(e)}),this.getOrders(n,e)}},{key:"getOrders",value:(e=(0,i.Z)(p().mark((function t(e){var n,i,a,o,r,s=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={city_id:e},t.next=3,this.getData("get_addr_zone",n);case 3:i=t.sent,a=[],i.map((function(t){t.zone_origin.length>0&&a.push(JSON.parse(t.zone_origin))})),o=[],r=!1,i.map((function(t){r=!1,o.map((function(e){parseInt(e.id)==parseInt(t.id)&&(r=!0)})),r||o.push(t)})),this.setState({}),setTimeout((function(){s.loadMap(i,a)}),500);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"loadMap",value:function(t,e){var n=this;this.map?(this.map.destroy(),this.map=null,console.log("destroy"),this.loadMap(t,e)):ymaps.ready((function(){n.map=new ymaps.Map("ForMap",{center:[t[0].xy_center_map.latitude,t[0].xy_center_map.longitude],zoom:10.8});var i=ymaps.templateLayoutFactory.createClass("<div class='my-hint'><b>{{ properties.address }}</b><br />Зона {{ properties.zone }}<br />График работы: c 10:00 до 21:30<br />Стоимость доставки: {{ properties.sum_div }} руб.</div>");e.map((function(e,a){n.map.geoObjects.add(new ymaps.Polygon([e],{address:t[a].addr,sum_div:t[a].sum_div,zone:t[a].test},{hintLayout:i,fillColor:"rgba(187, 0, 37, 0.25)",strokeColor:"rgb(187, 0, 37)",strokeWidth:5}))})),t.map((function(t){n.map.geoObjects.add(new ymaps.Placemark([t.xy_point.latitude,t.xy_point.longitude],{},{iconLayout:"default#image",iconImageHref:"/assets/img_other/Favikon.png",iconImageSize:[30,30],iconImageOffset:[-12,-24],iconContentOffset:[15,15]}))}))}))}},{key:"render",value:function(){return h.createElement(h.Fragment,null,h.createElement(g.Z,{open:this.state.is_load,style:{zIndex:99,color:"#fff"}},h.createElement(y.Z,{color:"inherit"})),h.createElement(f.q,null,h.createElement("title",null,"Карта")),h.createElement(m.ZP,{container:!0,spacing:3},h.createElement(m.ZP,{item:!0,xs:12,sm:3},h.createElement(v.$S,{data:this.state.cities,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),h.createElement(m.ZP,{item:!0,xs:12},h.createElement("div",{style:{width:"100%",height:650,marginRight:12,backgroundColor:"#e5e5e5"},id:"ForMap"}))))}}]),D}(h.Component)}}]);
//# sourceMappingURL=977.1e4b4051d7aaccaf9545.js.map