{"version":3,"file":"977.6bc638e40602802abfdb.js","mappings":"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","sources":["webpack://react-ssr/./src/components/map/map.component.jsx"],"sourcesContent":["import React from 'react';\n\nimport {Helmet} from \"react-helmet\";\n\nimport Grid from '@mui/material/Grid';\n\nimport PropTypes from 'prop-types';\n\nimport Backdrop from '@mui/material/Backdrop';\nimport CircularProgress from '@mui/material/CircularProgress';\n\nimport { MySelect } from '../../stores/elements';\n\nimport itemsStore from '../../stores/items-store';\nimport config from '../../stores/config';\n\nconst queryString = require('query-string');\n\nfunction formatDate(date) {\n  var d = new Date(date),\n      month = '' + (d.getMonth() + 1),\n      day = '' + d.getDate(),\n      year = d.getFullYear();\n\n  if (month.length < 2) \n      month = '0' + month;\n  if (day.length < 2) \n      day = '0' + day;\n\n  return [year, month, day].join('-');\n}\n\nexport class Map extends React.Component {\n  interval = null;\n  map = null;\n\n  constructor(props) {\n    super(props);\n        \n    this.state = {\n      module: 'concenter',\n      module_name: '',\n      is_load: false,\n      \n      modalDialog: false,\n      modalDialogDel: false,\n      \n      cities: [],\n      city_id: '',\n      date: formatDate(new Date()),\n      point_list: [],\n      need_point_list: [],\n      point_id: 0,\n      indexTab: 0,\n\n      orders: [],\n      ordersRender: [],\n      showOrder: null,\n\n      radiogroup_options: [\n        {id: '0', label: 'Решили отредактировать заказ', value: 0 },\n        {id: '1', label: 'Не устраивает время ожидания', value: 0 },\n        {id: '2', label: 'Изменились планы', value: 0 },\n        {id: '3', label: 'Недостаточно средств', value: 0 },\n        {id: '4', label: 'Другое', value: 0 },\n      ],\n      textDel: '',\n      typeDel: -1,\n\n      number: '',\n      addr: '',\n\n      allItems: []\n    };\n  }\n  \n  async checkLogin(){\n    let data = {\n      token: itemsStore.getToken()\n    }\n\n    let res = await this.getData('check_login_center', data);\n\n    if( res === true ){\n        \n    }else{\n      localStorage.removeItem('token');\n      clearInterval(this.interval)\n      setTimeout( () => {\n        window.location.href = '/auth'\n      }, 500 )\n    }\n  }\n\n  componentWillUnmount(){\n    clearInterval(this.interval)\n  }\n\n  async componentDidMount(){\n    if((window.location.protocol == 'http:' || window.location.protocol == 'http') && window.location.hostname != 'localhost'){\n      window.location.href = 'https://jacocallcenter.ru/'+window.location.pathname;\n    }\n\n    itemsStore.setPage('orders');\n    this.interval = setInterval(() => this.checkLogin(), 1000*60*60);\n    this.checkLogin();\n\n    let res = await this.getData('get_center_all');\n\n    let need_points = res.points.filter( (item, key) => parseInt(item.city_id) == parseInt(res.cities[0].id) );\n\n    console.log( res )\n\n\n    this.setState({\n      cities: res.cities,\n      point_list: res.points,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      city_id: parseInt(res.cities[0].id),\n    })\n    \n    setTimeout( () => {\n      this.getOrders(parseInt(res.cities[0].id));\n    }, 300 )\n  }\n  \n  getData = (method, data = {}) => {\n    \n    this.setState({\n      is_load: true\n    })\n    \n    data.type = method;\n    data.token = itemsStore.getToken();\n\n    return fetch(config.urlApi, {\n      method: 'POST',\n      headers: {\n        'Content-Type':'application/x-www-form-urlencoded'},\n      body: queryString.stringify( data ) \n    }).then(res => res.json()).then(json => {\n      \n      if( json.st === false && json.type == 'redir' ){\n        window.location.pathname = '/';\n        return;\n      }\n      \n      if( json.st === false && json.type == 'auth' ){\n        window.location.pathname = '/auth';\n        return;\n      }\n      \n      setTimeout( () => {\n        this.setState({\n          is_load: false\n        })\n      }, 300 )\n      \n      return json;\n    })\n    .catch(err => { \n      console.log( err )\n      this.setState({\n        is_load: false\n      })\n    });\n  }\n   \n  async changeCity(event){\n    this.setState({\n      number: '',\n      addr: ''\n    })\n\n    let data = event.target.value;\n    \n    let need_points = this.state.point_list.filter( (item, key) => parseInt(item.city_id) == parseInt(data) );\n\n    this.setState({\n      city_id: data,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      indexTab: 0\n    })\n\n    setTimeout( () => {\n      this.getOrders(parseInt(data));\n    }, 300 )\n  }\n  \n  changePoint(event, index){\n    let point_id = event.target.id;\n    point_id = point_id.split('-')[2]\n\n    this.setState({\n      point_id: point_id,\n      indexTab: parseInt(index)\n    })\n\n    this.getOrders(point_id, index);\n  }\n\n  async getOrders(city_id){\n    let data = {\n      city_id: city_id\n    };\n    \n    let json = await this.getData('get_addr_zone', data);\n\n    let points_zone = [];\n\n    json.map(function(point){\n\t\t\tif(point['zone_origin'].length > 0){\n\t\t\t\tpoints_zone.push( JSON.parse(point['zone_origin']) );\n\t\t\t}\n    })\n            \n    let unic_point = [],\n        check = false;\n            \n    json.map(function(point){\n      check = false;\n      \n      unic_point.map(function(new_point){\n        if( parseInt(new_point.id) == parseInt(point.id) ){\n          check = true;\n        }\n      })\n      \n      if( !check ){\n        unic_point.push(point)\n      }\n    })\n    \n    this.setState({\n      //points: json,\n      //unic_point: unic_point,\n      //is_load: true\n    })\n    \n    setTimeout(() => {\n      this.loadMap(json, points_zone);\n    }, 500);\n    \n  }\n\n  loadMap(points, points_zone){\n    //let myMap2;\n    \n    if( !this.map ){\n      ymaps.ready(() => {\n\n        this.map = new ymaps.Map('ForMap', {\n          center: [ points[0]['xy_center_map']['latitude'], points[0]['xy_center_map']['longitude'] ],\n          zoom: 10.8\n        });\n          \n        let HintLayout = ymaps.templateLayoutFactory.createClass( \n          \"<div class='my-hint'>\" +\n            \"<b>{{ properties.address }}</b><br />\" +\n            \"Зона {{ properties.zone }}<br />\" +\n            \"График работы: c 10:00 до 21:30<br />\" +\n            \"Стоимость доставки: {{ properties.sum_div }} руб.\" +\n          \"</div>\"\n        );\n    \n        points_zone.map((zone, key)=>{\n          this.map.geoObjects.add(\n            new ymaps.Polygon([zone], {\n              address: points[ key ]['addr'], \n              sum_div: points[ key ]['sum_div'], \n              zone: points[ key ]['test'],\n            }, {\n              hintLayout: HintLayout,\n              fillColor: 'rgba(187, 0, 37, 0.25)',\n              strokeColor: 'rgb(187, 0, 37)',\n              strokeWidth: 5\n            })\n          );\n        })\n          \n        points.map((point) => {\n          this.map.geoObjects.add(\n            new ymaps.Placemark( [point['xy_point']['latitude'], point['xy_point']['longitude']], {\n            }, {\n              iconLayout: 'default#image',\n              iconImageHref: '/assets/img_other/Favikon.png',\n              iconImageSize: [30, 30],\n              iconImageOffset: [-12, -24],\n              iconContentOffset: [15, 15],\n            })\n          )\n        })\n      })\n    }else{\n      this.map.destroy();\n      this.map = null;\n\n      console.log('destroy')\n\n      this.loadMap(points, points_zone);\n    }\n  }\n\n  render(){\n    return (\n      <>\n        <Backdrop open={this.state.is_load} style={{ zIndex: 99, color: '#fff' }}>\n          <CircularProgress color=\"inherit\" />\n        </Backdrop>\n        \n        <Helmet>\n          <title>Карта</title>\n        </Helmet>\n\n        \n        \n        <Grid container spacing={3}>\n          <Grid item xs={12} sm={3}>\n            <MySelect data={this.state.cities} value={this.state.city_id} func={ this.changeCity.bind(this) } label='Город' />\n          </Grid>\n\n          <Grid item xs={12}>\n            <div style={{ width: '100%', height: 650, marginRight: 12, backgroundColor: '#e5e5e5' }} id=\"ForMap\" />    \n          </Grid>\n          \n        </Grid>\n      </>\n    )\n  }\n}"],"names":["queryString","require","Map","props","date","d","month","day","year","method","data","setState","is_load","type","token","itemsStore","fetch","config","headers","body","stringify","then","res","json","st","setTimeout","window","location","pathname","err","console","log","state","module","module_name","modalDialog","modalDialogDel","cities","city_id","Date","getMonth","getDate","getFullYear","length","join","point_list","need_point_list","point_id","indexTab","orders","ordersRender","showOrder","radiogroup_options","id","label","value","textDel","typeDel","number","addr","allItems","this","getData","localStorage","removeItem","clearInterval","interval","href","protocol","hostname","setInterval","checkLogin","need_points","points","filter","item","key","parseInt","getOrders","event","target","index","split","points_zone","map","point","push","JSON","parse","unic_point","check","new_point","loadMap","destroy","ymaps","ready","center","zoom","HintLayout","templateLayoutFactory","createClass","zone","geoObjects","add","Polygon","address","sum_div","hintLayout","fillColor","strokeColor","strokeWidth","Placemark","iconLayout","iconImageHref","iconImageSize","iconImageOffset","iconContentOffset","Backdrop","open","style","zIndex","color","CircularProgress","Helmet","Grid","container","spacing","xs","sm","func","changeCity","bind","width","height","marginRight","backgroundColor","React"],"sourceRoot":""}