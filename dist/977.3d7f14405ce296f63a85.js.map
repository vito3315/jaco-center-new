{"version":3,"file":"977.3d7f14405ce296f63a85.js","mappings":"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","sources":["webpack://react-ssr/./src/components/map/map.component.jsx","webpack://react-ssr/./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"],"sourcesContent":["import React from 'react';\n\nimport {Helmet} from \"react-helmet\";\n\nimport Grid from '@mui/material/Grid';\nimport Button from '@mui/material/Button';\nimport ButtonGroup from '@mui/material/ButtonGroup';\n\nimport PropTypes from 'prop-types';\nimport Tabs from '@mui/material/Tabs';\nimport Tab from '@mui/material/Tab';\n\nimport Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableHead from '@mui/material/TableHead';\nimport TableRow from '@mui/material/TableRow';\nimport TableFooter from '@mui/material/TableFooter';\n\nimport Accordion from '@mui/material/Accordion';\nimport AccordionSummary from '@mui/material/AccordionSummary';\nimport AccordionDetails from '@mui/material/AccordionDetails';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\n\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\n\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport FormControl from '@mui/material/FormControl';\nimport TextField from '@mui/material/TextField';\n\nimport Backdrop from '@mui/material/Backdrop';\nimport CircularProgress from '@mui/material/CircularProgress';\n\nimport Typography from '@mui/material/Typography';\n\nimport { MySelect, MyDatePickerNew, MyTextInput } from '../../stores/elements';\n\nimport itemsStore from '../../stores/items-store';\nimport config from '../../stores/config';\n\nconst queryString = require('query-string');\n\nfunction formatDate(date) {\n  var d = new Date(date),\n      month = '' + (d.getMonth() + 1),\n      day = '' + d.getDate(),\n      year = d.getFullYear();\n\n  if (month.length < 2) \n      month = '0' + month;\n  if (day.length < 2) \n      day = '0' + day;\n\n  return [year, month, day].join('-');\n}\n\nfunction TabPanel(props) {\n  const { children, value, index, ...other } = props;\n\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`simple-tabpanel-${index}`}\n      aria-labelledby={`simple-tab-${index}`}\n      {...other}\n    >\n      {value === index && (\n        <Box sx={{ p: 3 }}>{children}</Box>\n      )}\n    </div>\n  );\n}\n\nTabPanel.propTypes = {\n  children: PropTypes.node,\n  index: PropTypes.number.isRequired,\n  value: PropTypes.number.isRequired,\n};\n\nfunction a11yProps(index) {\n  return {\n    id: `simple-tab-${index}`,\n    'aria-controls': `simple-tabpanel-${index}`,\n  };\n}\n\nexport class Map extends React.Component {\n  interval = null;\n  map = null;\n\n  constructor(props) {\n    super(props);\n        \n    this.state = {\n      module: 'concenter',\n      module_name: '',\n      is_load: false,\n      \n      modalDialog: false,\n      modalDialogDel: false,\n      \n      cities: [],\n      city_id: '',\n      date: formatDate(new Date()),\n      point_list: [],\n      need_point_list: [],\n      point_id: 0,\n      indexTab: 0,\n\n      orders: [],\n      ordersRender: [],\n      showOrder: null,\n\n      radiogroup_options: [\n        {id: '0', label: 'Решили отредактировать заказ', value: 0 },\n        {id: '1', label: 'Не устраивает время ожидания', value: 0 },\n        {id: '2', label: 'Изменились планы', value: 0 },\n        {id: '3', label: 'Недостаточно средств', value: 0 },\n        {id: '4', label: 'Другое', value: 0 },\n      ],\n      textDel: '',\n      typeDel: -1,\n\n      number: '',\n      addr: '',\n\n      allItems: []\n    };\n  }\n  \n  async checkLogin(){\n    let data = {\n      token: itemsStore.getToken()\n    }\n\n    let res = await this.getData('check_login_center', data);\n\n    if( res === true ){\n        \n    }else{\n      localStorage.removeItem('token');\n      clearInterval(this.interval)\n      setTimeout( () => {\n        window.location.href = '/auth'\n      }, 500 )\n    }\n  }\n\n  componentWillUnmount(){\n    clearInterval(this.interval)\n  }\n\n  async componentDidMount(){\n    itemsStore.setPage('orders');\n    this.interval = setInterval(() => this.checkLogin(), 1000*60*60);\n    this.checkLogin();\n\n    let res = await this.getData('get_center_all');\n\n    let need_points = res.points.filter( (item, key) => parseInt(item.city_id) == parseInt(res.cities[0].id) );\n\n    console.log( res )\n\n\n    this.setState({\n      cities: res.cities,\n      point_list: res.points,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      city_id: parseInt(res.cities[0].id),\n    })\n    \n    setTimeout( () => {\n      this.getOrders(parseInt(res.cities[0].id));\n    }, 300 )\n  }\n  \n  getData = (method, data = {}) => {\n    \n    this.setState({\n      is_load: true\n    })\n    \n    data.type = method;\n    data.token = itemsStore.getToken();\n\n    return fetch(config.urlApi, {\n      method: 'POST',\n      headers: {\n        'Content-Type':'application/x-www-form-urlencoded'},\n      body: queryString.stringify( data ) \n    }).then(res => res.json()).then(json => {\n      \n      if( json.st === false && json.type == 'redir' ){\n        window.location.pathname = '/';\n        return;\n      }\n      \n      if( json.st === false && json.type == 'auth' ){\n        window.location.pathname = '/auth';\n        return;\n      }\n      \n      setTimeout( () => {\n        this.setState({\n          is_load: false\n        })\n      }, 300 )\n      \n      return json;\n    })\n    .catch(err => { \n      console.log( err )\n      this.setState({\n        is_load: false\n      })\n    });\n  }\n   \n  async changeCity(event){\n    this.setState({\n      number: '',\n      addr: ''\n    })\n\n    let data = event.target.value;\n    \n    let need_points = this.state.point_list.filter( (item, key) => parseInt(item.city_id) == parseInt(data) );\n\n    this.setState({\n      city_id: data,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      indexTab: 0\n    })\n\n    setTimeout( () => {\n      this.getOrders(parseInt(data));\n    }, 300 )\n  }\n  \n  changePoint(event, index){\n    let point_id = event.target.id;\n    point_id = point_id.split('-')[2]\n\n    this.setState({\n      point_id: point_id,\n      indexTab: parseInt(index)\n    })\n\n    this.getOrders(point_id, index);\n  }\n\n  async getOrders(city_id){\n    let data = {\n      city_id: city_id\n    };\n    \n    let json = await this.getData('get_addr_zone', data);\n\n    let points_zone = [];\n\n    json.map(function(point){\n\t\t\tif(point['zone_origin'].length > 0){\n\t\t\t\tpoints_zone.push( JSON.parse(point['zone_origin']) );\n\t\t\t}\n    })\n            \n    let unic_point = [],\n        check = false;\n            \n    json.map(function(point){\n      check = false;\n      \n      unic_point.map(function(new_point){\n        if( parseInt(new_point.id) == parseInt(point.id) ){\n          check = true;\n        }\n      })\n      \n      if( !check ){\n        unic_point.push(point)\n      }\n    })\n    \n    this.setState({\n      //points: json,\n      //unic_point: unic_point,\n      //is_load: true\n    })\n    \n    setTimeout(() => {\n      this.loadMap(json, points_zone);\n    }, 500);\n    \n  }\n\n  loadMap(points, points_zone){\n    //let myMap2;\n    \n    if( !this.map ){\n      ymaps.ready(() => {\n\n        this.map = new ymaps.Map('ForMap', {\n          center: [ points[0]['xy_center_map']['latitude'], points[0]['xy_center_map']['longitude'] ],\n          zoom: 10.8\n        });\n          \n        let HintLayout = ymaps.templateLayoutFactory.createClass( \n          \"<div class='my-hint'>\" +\n            \"<b>{{ properties.address }}</b><br />\" +\n            \"Зона {{ properties.zone }}<br />\" +\n            \"График работы: c 10:00 до 21:30<br />\" +\n            \"Стоимость доставки: {{ properties.sum_div }} руб.\" +\n          \"</div>\"\n        );\n    \n        points_zone.map((zone, key)=>{\n          this.map.geoObjects.add(\n            new ymaps.Polygon([zone], {\n              address: points[ key ]['addr'], \n              sum_div: points[ key ]['sum_div'], \n              zone: points[ key ]['test'],\n            }, {\n              hintLayout: HintLayout,\n              fillColor: 'rgba(187, 0, 37, 0.25)',\n              strokeColor: 'rgb(187, 0, 37)',\n              strokeWidth: 5\n            })\n          );\n        })\n          \n        points.map((point) => {\n          this.map.geoObjects.add(\n            new ymaps.Placemark( [point['xy_point']['latitude'], point['xy_point']['longitude']], {\n            }, {\n              iconLayout: 'default#image',\n              iconImageHref: '/assets/img_other/Favikon.png',\n              iconImageSize: [30, 30],\n              iconImageOffset: [-12, -24],\n              iconContentOffset: [15, 15],\n            })\n          )\n        })\n      })\n    }else{\n      this.map.destroy();\n      this.map = null;\n\n      console.log('destroy')\n\n      this.loadMap(points, points_zone);\n    }\n  }\n\n  render(){\n    return (\n      <>\n        <Backdrop open={this.state.is_load} style={{ zIndex: 99, color: '#fff' }}>\n          <CircularProgress color=\"inherit\" />\n        </Backdrop>\n        \n        <Helmet>\n          <title>Карта</title>\n        </Helmet>\n\n        \n        \n        <Grid container spacing={3}>\n          <Grid item xs={12} sm={3}>\n            <MySelect data={this.state.cities} value={this.state.city_id} func={ this.changeCity.bind(this) } label='Город' />\n          </Grid>\n\n          <Grid item xs={12}>\n            <div style={{ width: '100%', height: 650, marginRight: 12, backgroundColor: '#e5e5e5' }} id=\"ForMap\" />    \n          </Grid>\n          \n        </Grid>\n      </>\n    )\n  }\n}","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}"],"names":["queryString","require","PropTypes","Map","props","date","d","month","day","year","method","data","setState","is_load","type","token","itemsStore","fetch","config","headers","body","stringify","then","res","json","st","setTimeout","window","location","pathname","err","console","log","state","module","module_name","modalDialog","modalDialogDel","cities","city_id","Date","getMonth","getDate","getFullYear","length","join","point_list","need_point_list","point_id","indexTab","orders","ordersRender","showOrder","radiogroup_options","id","label","value","textDel","typeDel","number","addr","allItems","this","getData","localStorage","removeItem","clearInterval","interval","href","setInterval","checkLogin","need_points","points","filter","item","key","parseInt","getOrders","event","target","index","split","points_zone","map","point","push","JSON","parse","unic_point","check","new_point","loadMap","destroy","ymaps","ready","center","zoom","HintLayout","templateLayoutFactory","createClass","zone","geoObjects","add","Polygon","address","sum_div","hintLayout","fillColor","strokeColor","strokeWidth","Placemark","iconLayout","iconImageHref","iconImageSize","iconImageOffset","iconContentOffset","Backdrop","open","style","zIndex","color","CircularProgress","Helmet","Grid","container","spacing","xs","sm","func","changeCity","bind","width","height","marginRight","backgroundColor","React","_objectWithoutProperties","source","excluded","i","Object","getOwnPropertySymbols","sourceSymbolKeys","indexOf","prototype","propertyIsEnumerable","call"],"sourceRoot":""}