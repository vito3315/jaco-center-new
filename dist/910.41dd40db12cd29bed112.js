"use strict";(self.webpackChunkreact_ssr=self.webpackChunkreact_ssr||[]).push([[910],{9910:(t,e,n)=>{n.r(e),n.d(e,{default:()=>A});var i=n(467),a=n(3029),o=n(2901),r=n(6822),s=n(3954),c=n(5501),l=n(4467),u=n(4756),d=n.n(u),p=n(6540),h=n(8154),m=n(8239),f=n(7419),g=n(3357),y=n(5041),v=n(3259),_=n(9060),w=n.n(_);function k(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(k=function(){return!!t})()}var b=n(6663),A=function(t){function e(t){var n,i,o,c,u,d,p,h,m;return(0,a.A)(this,e),i=this,o=e,c=[t],o=(0,s.A)(o),n=(0,r.A)(i,k()?Reflect.construct(o,c||[],(0,s.A)(i).constructor):o.apply(i,c)),(0,l.A)(n,"interval",null),(0,l.A)(n,"map",null),(0,l.A)(n,"getData",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.setState({is_load:!0}),e.type=t,e.token=v.A.getToken(),fetch(w().urlApi,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.stringify(e)}).then((function(t){return t.json()})).then((function(t){if(!1!==t.st||"redir"!=t.type){if(!1!==t.st||"auth"!=t.type)return setTimeout((function(){n.setState({is_load:!1})}),300),t;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(t){console.log(t),n.setState({is_load:!1})}))})),n.state={module:"concenter",module_name:"",is_load:!1,modalDialog:!1,modalDialogDel:!1,cities:[],city_id:"",date:(u=new Date,d=new Date(u),p=""+(d.getMonth()+1),h=""+d.getDate(),m=d.getFullYear(),p.length<2&&(p="0"+p),h.length<2&&(h="0"+h),[m,p,h].join("-")),point_list:[],need_point_list:[],point_id:0,indexTab:0,orders:[],ordersRender:[],showOrder:null,radiogroup_options:[{id:"0",label:"Решили отредактировать заказ",value:0},{id:"1",label:"Не устраивает время ожидания",value:0},{id:"2",label:"Изменились планы",value:0},{id:"3",label:"Недостаточно средств",value:0},{id:"4",label:"Другое",value:0}],textDel:"",typeDel:-1,number:"",addr:"",allItems:[]},n}return(0,c.A)(e,t),(0,o.A)(e,[{key:"checkLogin",value:(A=(0,i.A)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={token:v.A.getToken()},t.next=3,this.getData("check_login_center",e);case 3:!0===t.sent||(localStorage.removeItem("token"),clearInterval(this.interval),setTimeout((function(){window.location.href="/auth"}),500));case 5:case"end":return t.stop()}}),t,this)}))),function(){return A.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"componentDidMount",value:(_=(0,i.A)(d().mark((function t(){var e,n,i=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"http:"!=window.location.protocol&&"http"!=window.location.protocol||"localhost"==window.location.hostname||(window.location.href="https://jacocallcenter.ru"+window.location.pathname),v.A.setPage("orders"),this.interval=setInterval((function(){return i.checkLogin()}),36e5),this.checkLogin(),t.next=6,this.getData("get_center_all");case 6:e=t.sent,n=e.points.filter((function(t,n){return parseInt(t.city_id)==parseInt(e.cities[0].id)})),console.log(e),this.setState({cities:e.cities,point_list:e.points,need_point_list:n,point_id:parseInt(n[0].id),city_id:parseInt(e.cities[0].id)}),setTimeout((function(){i.getOrders(parseInt(e.cities[0].id))}),300);case 11:case"end":return t.stop()}}),t,this)}))),function(){return _.apply(this,arguments)})},{key:"changeCity",value:(u=(0,i.A)(d().mark((function t(e){var n,i,a=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({number:"",addr:""}),n=e.target.value,i=this.state.point_list.filter((function(t,e){return parseInt(t.city_id)==parseInt(n)})),this.setState({city_id:n,need_point_list:i,point_id:parseInt(i[0].id),indexTab:0}),setTimeout((function(){a.getOrders(parseInt(n))}),300);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"changePoint",value:function(t,e){var n=t.target.id;n=n.split("-")[2],this.setState({point_id:n,indexTab:parseInt(e)}),this.getOrders(n,e)}},{key:"getOrders",value:(n=(0,i.A)(d().mark((function t(e){var n,i,a,o,r,s=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={city_id:e},t.next=3,this.getData("get_addr_zone",n);case 3:i=t.sent,a=[],i.map((function(t){t.zone_origin.length>0&&a.push(JSON.parse(t.zone_origin))})),o=[],r=!1,i.map((function(t){r=!1,o.map((function(e){parseInt(e.id)==parseInt(t.id)&&(r=!0)})),r||o.push(t)})),this.setState({}),setTimeout((function(){s.loadMap(i,a)}),500);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"loadMap",value:function(t,e){var n=this;this.map?(this.map.destroy(),this.map=null,console.log("destroy"),this.loadMap(t,e)):ymaps.ready((function(){n.map=new ymaps.Map("ForMap",{center:[t[0].xy_center_map.latitude,t[0].xy_center_map.longitude],zoom:10.8});var i=ymaps.templateLayoutFactory.createClass("<div class='my-hint'><b>{{ properties.address }}</b><br />Зона {{ properties.zone }}<br />График работы: c 10:00 до 21:30<br />Стоимость доставки: {{ properties.sum_div }} руб.</div>");e.map((function(e,a){n.map.geoObjects.add(new ymaps.Polygon([e],{address:t[a].addr,sum_div:t[a].sum_div,zone:t[a].test},{hintLayout:i,fillColor:"rgba(187, 0, 37, 0.25)",strokeColor:"rgb(187, 0, 37)",strokeWidth:5}))})),t.map((function(t){n.map.geoObjects.add(new ymaps.Placemark([t.xy_point.latitude,t.xy_point.longitude],{},{iconLayout:"default#image",iconImageHref:"/assets/img_other/Favikon.png",iconImageSize:[30,30],iconImageOffset:[-12,-24],iconContentOffset:[15,15]}))}))}))}},{key:"render",value:function(){return p.createElement(p.Fragment,null,p.createElement(f.A,{open:this.state.is_load,style:{zIndex:99,color:"#fff"}},p.createElement(g.A,{color:"inherit"})),p.createElement(h.m,null,p.createElement("title",null,"Карта")),p.createElement(m.Ay,{container:!0,spacing:3},p.createElement(m.Ay,{item:!0,xs:12,sm:3},p.createElement(y.DI,{data:this.state.cities,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),p.createElement(m.Ay,{item:!0,xs:12},p.createElement("div",{style:{width:"100%",height:650,marginRight:12,backgroundColor:"#e5e5e5"},id:"ForMap"}))))}}]);var n,u,_,A}(p.Component)}}]);
//# sourceMappingURL=910.41dd40db12cd29bed112.js.map