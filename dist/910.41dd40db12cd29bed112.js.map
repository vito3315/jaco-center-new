{"version":3,"file":"910.41dd40db12cd29bed112.js","mappings":"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","sources":["webpack://react-ssr/./src/components/map/map.component.jsx"],"sourcesContent":["import React from 'react';\n\nimport {Helmet} from \"react-helmet\";\n\nimport Grid from '@mui/material/Grid';\n\nimport PropTypes from 'prop-types';\n\nimport Backdrop from '@mui/material/Backdrop';\nimport CircularProgress from '@mui/material/CircularProgress';\n\nimport { MySelect } from '../../stores/elements';\n\nimport itemsStore from '../../stores/items-store';\nimport config from '../../stores/config';\n\nconst queryString = require('query-string');\n\nfunction formatDate(date) {\n  var d = new Date(date),\n      month = '' + (d.getMonth() + 1),\n      day = '' + d.getDate(),\n      year = d.getFullYear();\n\n  if (month.length < 2) \n      month = '0' + month;\n  if (day.length < 2) \n      day = '0' + day;\n\n  return [year, month, day].join('-');\n}\n\nexport class Map extends React.Component {\n  interval = null;\n  map = null;\n\n  constructor(props) {\n    super(props);\n        \n    this.state = {\n      module: 'concenter',\n      module_name: '',\n      is_load: false,\n      \n      modalDialog: false,\n      modalDialogDel: false,\n      \n      cities: [],\n      city_id: '',\n      date: formatDate(new Date()),\n      point_list: [],\n      need_point_list: [],\n      point_id: 0,\n      indexTab: 0,\n\n      orders: [],\n      ordersRender: [],\n      showOrder: null,\n\n      radiogroup_options: [\n        {id: '0', label: 'Решили отредактировать заказ', value: 0 },\n        {id: '1', label: 'Не устраивает время ожидания', value: 0 },\n        {id: '2', label: 'Изменились планы', value: 0 },\n        {id: '3', label: 'Недостаточно средств', value: 0 },\n        {id: '4', label: 'Другое', value: 0 },\n      ],\n      textDel: '',\n      typeDel: -1,\n\n      number: '',\n      addr: '',\n\n      allItems: []\n    };\n  }\n  \n  async checkLogin(){\n    let data = {\n      token: itemsStore.getToken()\n    }\n\n    let res = await this.getData('check_login_center', data);\n\n    if( res === true ){\n        \n    }else{\n      localStorage.removeItem('token');\n      clearInterval(this.interval)\n      setTimeout( () => {\n        window.location.href = '/auth'\n      }, 500 )\n    }\n  }\n\n  componentWillUnmount(){\n    clearInterval(this.interval)\n  }\n\n  async componentDidMount(){\n    if((window.location.protocol == 'http:' || window.location.protocol == 'http') && window.location.hostname != 'localhost'){\n      window.location.href = 'https://jacocallcenter.ru'+window.location.pathname;\n    }\n\n    itemsStore.setPage('orders');\n    this.interval = setInterval(() => this.checkLogin(), 1000*60*60);\n    this.checkLogin();\n\n    let res = await this.getData('get_center_all');\n\n    let need_points = res.points.filter( (item, key) => parseInt(item.city_id) == parseInt(res.cities[0].id) );\n\n    console.log( res )\n\n\n    this.setState({\n      cities: res.cities,\n      point_list: res.points,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      city_id: parseInt(res.cities[0].id),\n    })\n    \n    setTimeout( () => {\n      this.getOrders(parseInt(res.cities[0].id));\n    }, 300 )\n  }\n  \n  getData = (method, data = {}) => {\n    \n    this.setState({\n      is_load: true\n    })\n    \n    data.type = method;\n    data.token = itemsStore.getToken();\n\n    return fetch(config.urlApi, {\n      method: 'POST',\n      headers: {\n        'Content-Type':'application/x-www-form-urlencoded'},\n      body: queryString.stringify( data ) \n    }).then(res => res.json()).then(json => {\n      \n      if( json.st === false && json.type == 'redir' ){\n        window.location.pathname = '/';\n        return;\n      }\n      \n      if( json.st === false && json.type == 'auth' ){\n        window.location.pathname = '/auth';\n        return;\n      }\n      \n      setTimeout( () => {\n        this.setState({\n          is_load: false\n        })\n      }, 300 )\n      \n      return json;\n    })\n    .catch(err => { \n      console.log( err )\n      this.setState({\n        is_load: false\n      })\n    });\n  }\n   \n  async changeCity(event){\n    this.setState({\n      number: '',\n      addr: ''\n    })\n\n    let data = event.target.value;\n    \n    let need_points = this.state.point_list.filter( (item, key) => parseInt(item.city_id) == parseInt(data) );\n\n    this.setState({\n      city_id: data,\n      need_point_list: need_points,\n      point_id: parseInt(need_points[0].id),\n      indexTab: 0\n    })\n\n    setTimeout( () => {\n      this.getOrders(parseInt(data));\n    }, 300 )\n  }\n  \n  changePoint(event, index){\n    let point_id = event.target.id;\n    point_id = point_id.split('-')[2]\n\n    this.setState({\n      point_id: point_id,\n      indexTab: parseInt(index)\n    })\n\n    this.getOrders(point_id, index);\n  }\n\n  async getOrders(city_id){\n    let data = {\n      city_id: city_id\n    };\n    \n    let json = await this.getData('get_addr_zone', data);\n\n    let points_zone = [];\n\n    json.map(function(point){\n\t\t\tif(point['zone_origin'].length > 0){\n\t\t\t\tpoints_zone.push( JSON.parse(point['zone_origin']) );\n\t\t\t}\n    })\n            \n    let unic_point = [],\n        check = false;\n            \n    json.map(function(point){\n      check = false;\n      \n      unic_point.map(function(new_point){\n        if( parseInt(new_point.id) == parseInt(point.id) ){\n          check = true;\n        }\n      })\n      \n      if( !check ){\n        unic_point.push(point)\n      }\n    })\n    \n    this.setState({\n      //points: json,\n      //unic_point: unic_point,\n      //is_load: true\n    })\n    \n    setTimeout(() => {\n      this.loadMap(json, points_zone);\n    }, 500);\n    \n  }\n\n  loadMap(points, points_zone){\n    //let myMap2;\n    \n    if( !this.map ){\n      ymaps.ready(() => {\n\n        this.map = new ymaps.Map('ForMap', {\n          center: [ points[0]['xy_center_map']['latitude'], points[0]['xy_center_map']['longitude'] ],\n          zoom: 10.8\n        });\n          \n        let HintLayout = ymaps.templateLayoutFactory.createClass( \n          \"<div class='my-hint'>\" +\n            \"<b>{{ properties.address }}</b><br />\" +\n            \"Зона {{ properties.zone }}<br />\" +\n            \"График работы: c 10:00 до 21:30<br />\" +\n            \"Стоимость доставки: {{ properties.sum_div }} руб.\" +\n          \"</div>\"\n        );\n    \n        points_zone.map((zone, key)=>{\n          this.map.geoObjects.add(\n            new ymaps.Polygon([zone], {\n              address: points[ key ]['addr'], \n              sum_div: points[ key ]['sum_div'], \n              zone: points[ key ]['test'],\n            }, {\n              hintLayout: HintLayout,\n              fillColor: 'rgba(187, 0, 37, 0.25)',\n              strokeColor: 'rgb(187, 0, 37)',\n              strokeWidth: 5\n            })\n          );\n        })\n          \n        points.map((point) => {\n          this.map.geoObjects.add(\n            new ymaps.Placemark( [point['xy_point']['latitude'], point['xy_point']['longitude']], {\n            }, {\n              iconLayout: 'default#image',\n              iconImageHref: '/assets/img_other/Favikon.png',\n              iconImageSize: [30, 30],\n              iconImageOffset: [-12, -24],\n              iconContentOffset: [15, 15],\n            })\n          )\n        })\n      })\n    }else{\n      this.map.destroy();\n      this.map = null;\n\n      console.log('destroy')\n\n      this.loadMap(points, points_zone);\n    }\n  }\n\n  render(){\n    return (\n      <>\n        <Backdrop open={this.state.is_load} style={{ zIndex: 99, color: '#fff' }}>\n          <CircularProgress color=\"inherit\" />\n        </Backdrop>\n        \n        <Helmet>\n          <title>Карта</title>\n        </Helmet>\n\n        \n        \n        <Grid container spacing={3}>\n          <Grid item xs={12} sm={3}>\n            <MySelect data={this.state.cities} value={this.state.city_id} func={ this.changeCity.bind(this) } label='Город' />\n          </Grid>\n\n          <Grid item xs={12}>\n            <div style={{ width: '100%', height: 650, marginRight: 12, backgroundColor: '#e5e5e5' }} id=\"ForMap\" />    \n          </Grid>\n          \n        </Grid>\n      </>\n    )\n  }\n}"],"names":["queryString","require","Map","_React$Component","props","_this","date","d","month","day","year","_classCallCheck","_defineProperty","method","data","arguments","length","undefined","setState","is_load","type","token","itemsStore","getToken","fetch","config","headers","body","stringify","then","res","json","st","setTimeout","window","location","pathname","err","console","log","state","module","module_name","modalDialog","modalDialogDel","cities","city_id","Date","getMonth","getDate","getFullYear","join","point_list","need_point_list","point_id","indexTab","orders","ordersRender","showOrder","radiogroup_options","id","label","value","textDel","typeDel","number","addr","allItems","_inherits","_createClass","key","_checkLogin","_asyncToGenerator","_regeneratorRuntime","_callee","_context","prev","next","this","getData","sent","localStorage","removeItem","clearInterval","interval","href","stop","apply","_componentDidMount","_callee2","need_points","_this2","_context2","protocol","hostname","setPage","setInterval","checkLogin","points","filter","item","parseInt","getOrders","_changeCity","_callee3","event","_this3","_context3","target","_x","index","split","_getOrders","_callee4","points_zone","unic_point","check","_this4","_context4","map","point","push","JSON","parse","new_point","loadMap","_x2","_this5","destroy","ymaps","ready","center","zoom","HintLayout","templateLayoutFactory","createClass","zone","geoObjects","add","Polygon","address","sum_div","hintLayout","fillColor","strokeColor","strokeWidth","Placemark","iconLayout","iconImageHref","iconImageSize","iconImageOffset","iconContentOffset","React","Backdrop","open","style","zIndex","color","CircularProgress","Helmet","Grid","container","spacing","xs","sm","MySelect","func","changeCity","bind","width","height","marginRight","backgroundColor"],"sourceRoot":""}